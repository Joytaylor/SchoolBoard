<!DOCTYPE html>
<html id="classPage">

<head>
    <!--Samuel Anozie, July 29, 2017. V0.1 Redesign September 2019.-->
    <title>
        <%=class_data.class_name%> | SchoolBoard</title>
    <meta charset="UTF-8" />

    <!-- Bootstrap Links -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!--Socket-->
    <!--<script src="/socket.io/socket.io.js"></script>-->
    <script>
        /*
                                                                                                                                                                                                                                                                                                                var demoObject = {
                                                                                                                                                                                                                                                                                                                    class_code: "hey"
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                $(function() {
                                                                                                                                                                                                                                                                                                                    var socket = io();
                                                                                                                                                                                                                                                                                                                    $(".menuItem").on('click', function(e) {
                                                                                                                                                                                                                                                                                                                        var data = $(this).attr('id');
                                                                                                                                                                                                                                                                                                                        e.preventDefault(); // prevents page reloading
                                                                                                                                                                                                                                                                                                                        socket.emit('menu', data);
                                                                                                                                                                                                                                                                                                                        return false;
                                                                                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                                                                                    socket.on('rewrite', function() {
                                                                                                                                                                                                                                                                                                                        class_data.class_code = "wawa"
                                                                                                                                                                                                                                                                                                                    })
                                                                                                                                                                                                                                                                                                                });*/
    </script>

    <!--Local Links-->
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <link rel="icon" href="favicon.png" type="image/jpg" />
    <script src="animations.js"></script>
</head>

<body>
    <div id="blur">
        <header>
            <div class="container-fluid h-100">
                <div class="row justify-content-center h-100">
                    <div id="logoContainer" class="col-4">
                        <img id="logo" src="/Logo.svg" class="img-fluid" />
                    </div>
                    <div id="headingContainer" class="col-4">
                        <div class="w-100">
                            <div class="row justify-content-center">
                                <div class="col-8 text-center">
                                    <h1 id="classCode">
                                        <%=class_data.class_code%>
                                    </h1>
                                </div>
                            </div>
                            <%if(user_data.status != "teacher") {%>
                                <div class="row justify-content-center">
                                    <div class="col-8 text-center">
                                        <button onclick='toggleDisplays("question")' id="askQuestion" class="btn">Ask a Question</button>
                                    </div>
                                </div>
                                <%}%>
                        </div>
                    </div>
                    <div id="navContainer" class="col-4">
                        <div class="row">
                            <div class="col-6 text-center">
                                <a class="nav-link" href="/account">Account</a>
                            </div>
                            <div class="col-6 text-center">
                                <a class="nav-link" href="/">Home</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <div id="app" class="container-fluid">
            <div class="row justify-content-center">
                <div id="timeMenu" class="col-2 sideMenu align-self-start">
                    <div class="row">
                        <div class="col-12">
                            <p class="menuItem timeMenuItem" data-queryType="thisWeek">This Week</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <p class="menuItem timeMenuItem" data-queryType="thisMonth">This Month</p>
                        </div>
                    </div>
                    <!--Add feature for this semester-->
                    <div class="row">
                        <div class="col-12">
                            <p class="menuItem timeMenuItem active" data-queryType="allTime">All Time</p>
                        </div>
                    </div>
                </div>
                <%if(question_info.length == 0) {%>
                    <p class='null'>No questions asked yet</p>
                    <%} else {%>
                        <div id="questionContainer" class="col-6">
                            <div id="questionPaste" class="row">
                                <%question_info.forEach(data => {%>
                                    <div class="question card-primary col-md-12">
                                        <div class="header card-header row">
                                            <div class="hashtags col-10 d-flex">
                                                <h3 class="align-self-center">
                                                    <%data.hashtags.forEach(topic => {%>
                                                        <%="#"+topic%>
                                                            <%})%>
                                                </h3>
                                            </div>
                                            <div class="vote col-2">
                                                <div id="<%=data.id%>" type="submit" class="voteButton btn" onclick="disableAndAnimate('<%=data.id%>')" <% if(data.voter_ids) { data.voter_ids.forEach(voterId=> { if(voterId == user_data.id) { %> disabled
                                                    <%}})}%>
                                                        ><span class="font-weight-bold"><%=data.votes%></span> Votes</div>
                                                <script>
                                                    var id = "#<%=data.id%>"
                                                    $(id).click(function() {
                                                        $.ajax({
                                                            url: "/vote",
                                                            type: "POST",
                                                            data: {
                                                                question_id: "<%=data.id%>"
                                                            }
                                                        })
                                                    })
                                                </script>
                                            </div>
                                        </div>
                                        <div class="questionText card-body row">
                                            <div class="col-12 questionBody">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <p>
                                                            <%=data.question_text%>
                                                        </p>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div id="timeContainer" class="col-12 text-center">
                                                        <p class="timestamp">
                                                            <%=data.date_of_ask%>
                                                        </p>
                                                    </div>
                                                </div>
                                                <%if(user_data.status == "teacher") {%>
                                                    <button class="btn card-btn" onclick='toggleDisplays("answer", "<%=data.question_text%>", "<%=data.id%>")'>Answer</button>
                                                    <%}%>
                                            </div>
                                        </div>
                                        <% if(data.responses) { %>
                                            <div class="questionResponse row">
                                                <% data.responses.forEach(response => { %>
                                                    <div id="responseContainer" class="col-12">
                                                        <p>
                                                            <%=response.teacher_response %>
                                                        </p>
                                                    </div>
                                                    <%})}%>
                                            </div>
                                    </div>
                                    <%})%>
                            </div>
                        </div>
                        <%}%>
                            <div id="voteMenu" class="col-2 sideMenu align-self-start">
                                <div class="col-12 text-right">
                                    <p data-queryType="recentQuestions" class="menuItem filterMenuItem active">Recent Questions</p>
                                </div>
                                <!--Add Recent Answers-->
                                <div class="col-12 text-right">
                                    <p data-queryType="mostVoted" class="menuItem filterMenuItem">Most Voted</p>
                                </div>
                                <%if(user_data.status == "teacher") {%>
                                    <div class="col-12 text-right">
                                        <p class="menuItem filterMenuItem">Least Voted</p>
                                    </div>
                                    <%}%>
                            </div>
            </div>
        </div>
    </div>

    <!--Spaces that contain the question form and the answer form-->
    <div id="black" onclick="toggleDisplays('outfocus')" class="position-fixed inactive"></div>
    <div id="invisibleQuestionContainer" class="position-fixed invisibleSpace inactive">
        <div class="askContainer row justify-content-center">
            <div class="col-md-12">
                <div class="row justify-content-center text-center">
                    <h4>Ask a Question</h4>
                </div>
                <form action="/addQuestion" method="post">
                    <div class="row justify-content-center">
                        <div id="askCard" class="col-md-12 card">
                            <div id="askCardHeader" class="row">
                                <div class="col-12">
                                    <input type="hidden" value="<%=class_data.id%>" name="class_id" />
                                    <div class="row card-header">
                                        <div class="col-md-12">
                                            <div class="row">
                                                <p>Add hashtags here (all one word, CamelCase!)</p>
                                            </div>
                                            <div class="row">
                                                <div id="hashtagPaste" class="col-9">
                                                    <div class="row hashtagElement">
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <span class="input-group-text" id="basic-addon1">#</span>
                                                            </div>
                                                            <input type="text" class="form-control" name="hashtag" placeholder="Hashtag" aria-label="Username" aria-describedby="basic-addon1">
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col-3 align-self-start">
                                                    <button type="button" id="addInput" class="btn" onclick="addHashtag()">Add #</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <p>Ask your question. Remember to be respectful!</p>
                                            <textarea placeholder="Start typing here..." name="question"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-6 text-center">
                            <button id="questionSubmit" type="submit" class="btn">Submit</button>
                            <!--Add a function that confirms that the question has been subitted-->
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="invisibleAnswerContainer" class="position-fixed invisibleSpace inactive">
        <div class="askContainer row justify-content-center">
            <div class="col-md-9">
                <div class="row justify-content-center text-center">
                    <h4>Answer a Question</h4>
                </div>
                <form action="/addAnswer" method="POST">
                    <div class="row justify-content-center">
                        <div id="askCard" class="col-md-12 card">
                            <div id="askCardHeader" class="row">
                                <div class="col-12">
                                    <div class="row card-header">
                                        <div class="col-md-12">
                                            <div class="row">
                                                <!--Paste question text here-->
                                                <p id="questionPreview"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <p>Answer your student's question. Remember to be respectful!</p>
                                            <textarea placeholder="Start typing here..." name="teacher_response"></textarea>
                                        </div>
                                    </div>
                                    <input id="answerResponseID" type="hidden" name="question_id" />
                                    <input id="classResopnseID" type="hidden" name="class_id" value="<%=class_data.id%>" />

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-6 text-center">
                            <button type="submit" class="btn">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        $(".menuItem").on('click', function() {
            var data = [];
            //Changing active status and getting data
            if ($(this).hasClass("timeMenuItem")) {
                $(".timeMenuItem").removeClass("active");
                $(this).addClass("active");
                data.push($(this).attr("data-queryType"));
                data.push($(".filterMenuItem.active").attr("data-queryType"));
            } else if ($(this).hasClass("filterMenuItem")) {
                $(".filterMenuItem").removeClass("active");
                $(this).addClass("active");
                data.push($(this).attr("data-queryType"));
                data.push($(".timeMenuItem.active").attr("data-queryType"));
            }
            var classID = "<%=class_data.id%>";

            //Sending data and getting res
            $.ajax({
                url: "/timeQuery",
                type: 'post',
                data: {
                    queryType: data,
                    classID: classID
                }
            }).done(res => {
                $("#questionPaste").html(res)
            });
        })
    </script>
</body>

</html>